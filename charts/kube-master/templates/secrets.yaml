{{/* vim: set filetype=gotexttmpl: */ -}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "master.fullname" . }}
  labels:
    chart: "{{ .Chart.Name }}-{{ .Chart.Version | replace "+" "_" }}"
    release: {{ .Release.Name }}
type: Opaque
data:
  openstack.config: {{ include (print $.Template.BasePath "/_openstack.config.tpl") . | b64enc}}

{{- if empty .Values.certsSecretName }}
{{- range list "apiserver-clients-ca.pem" "apiserver-clients-ca-key.pem" "etcd-clients-ca.pem" "etcd-clients-apiserver.pem" "etcd-clients-apiserver-key.pem" "kubelet-clients-ca-key.pem" "kubelet-clients-apiserver.pem" "kubelet-clients-apiserver-key.pem" "tls-ca.pem" "tls-apiserver.pem" "tls-apiserver-key.pem" "apiserver-nodes-ca.pem" "apiserver-nodes-ca-key.pem" "apiserver-clients-system-kube-controller-manager.pem" "apiserver-clients-system-kube-controller-manager-key.pem" "apiserver-clients-system-kube-scheduler.pem" "apiserver-clients-system-kube-scheduler-key.pem" }}
  {{ . }}: {{ required (printf "missing cert/key: %s" .) (index $.Values.certs .) | b64enc -}}
{{ end }}
{{ end }}
